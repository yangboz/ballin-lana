<!DOCTYPE html>
<html>
	<head>
		<title>People Monitor Web Demo</title>
		<script src="js/Chart.js"></script>
		<meta charset="utf-8">
		<style>
			canvas{
			}
		</style>
	</head>
	
	<body>
		<!-- <script src="js/myInclude.js"></script> -->
		<script type="text/javascript" src="js/environment.js"></script>
		<script type="text/javascript" src="js/utils.js"></script>
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/jquery.video-ui.js"></script>		
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
		<!-- Optional theme -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
		<!-- Latest compiled and minified JavaScript -->
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="css/layout.css"/>
		
		
		<ol class="breadcrumb">
		  <li><a href="index.html">Main Page</a></li>
		  <li><a href="#">Face Counting</a></li>
		  <li class="active">Appearance Duration Chart</li>
		</ol>
		
		<div class="panel panel-primary">
		  <div class="panel-heading">Face Counting
		  	<p></p>
		  	<p>Face Counting can detect faces of people passing through a camera and track them. This can produce a count of the number of people passing through the camera during any time interval. This module can be used for surveillance videos which has clearly visible faces.</p>
		</div>
		  <div class="panel-body">
		    <div class="media">
			  <a class="pull-left" href="#">
			    <div class="videoUiWrapper thumbnail">
			    	<button type="button" class="btn btn-default btn-lg" onclick="playPause()">
					  		<span id="play/pause" class="glyphicon glyphicon-play"></span>Play/Pause
				  	  	</button>
					  	<button type="button" class="btn btn-default btn-lg" onclick="stop()">
					  		<span id="stop" class="glyphicon glyphicon-stop"></span>Stop
					  	</button>
					  	<br /> 
				  <video width="370" height="214" id="demo1" controls>
				  	
				    <source src="data/SubwayFaceCountingDemo.ogg" type="video/ogg">
				    Your browser does not support the video tag.
				  </video>
				</div>
			  </a>
			  <div class="media-body">
			  	
			  </div>
				  <div>
			  		<!-- <select id="select-clip" onclick="playSelected()"> -->
		  			<select id="select-clip">
					  
					</select>
					<button onclick="playSelectedContent()">View</button>
				  	</div>
			  	<canvas id="canvas" height="600" width="900"></canvas>
			  					
			</div>
		  </div>
		  <div class="panel-footer">Subway video</div>
		</div>
		
		<script type="text/javascript">
		
		 	var myVideo=document.getElementById("demo1");
			var mySpan=document.getElementById("play/pause");
			
			function getData(str) {  
    		var arr = str;  
    		var myLabels = new Array();
    		var myData = new Array();
    		var slt=document.getElementById("select-clip");
    		 // alert(arr[11]);
    		for(var i=0;i<str.length;++i)
    		{
    			myLabels[i]=arr[i].labels;
    			myData[i]=arr[i].data;
    			if(i==0) continue;
    			var objOption=document.createElement("OPTION");
    			objOption.text="person: "+arr[i].labels;
    			objOption.value=arr[i].start_frame+"_"+arr[i].end_frame;
    			if(arr[i].data==0) objOption.disabled="disabled";
    			slt.add(objOption);
    		}
    		
    		var scaleSteps = 40;
    		var max =  Math.max.apply(null,myData);
    		var scaleOverride = true;
    		var scaleStepWidth =  Math.floor(max / scaleSteps) + 1;
    		var Ymax = scaleStepWidth * scaleSteps;
    		var scaleStartValue = 0;

			var config = new Array();
			config['scaleOverride'] = scaleOverride;
			config['scaleSteps'] = scaleSteps;
			config['scaleStepWidth'] = scaleStepWidth;
			config['scaleStartValue'] = scaleStartValue;
			    		
			var barChartData = {
			labels : myLabels,
			datasets : [
				{
					fillColor : "rgba(151,187,205,0.5)",
					strokeColor : "rgba(151,187,205,1)",
					pointColor : "rgba(151,187,205,1)",
					pointStrokeColor : "#fff",
					data : myData
				}
			],
			configs : config
			
		};

		var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Bar(barChartData);
		
		
	}
	
	
	
	function playSelectedContent(){
		var obj = document.getElementById("select-clip"); //selectid
		var index = obj.selectedIndex; // 选中索引
		value = obj.options[index].value;
		var params = value.split('_');
		var s_f = params[0];
		var e_f = params[1];
		playClip(s_f,e_f);
	}
	
			
			function playPause(){
				if(myVideo.paused){
					myVideo.play();
					mySpan.className="glyphicon glyphicon-pause";
				}
				else{
					myVideo.pause();
					mySpan.className="glyphicon glyphicon-play";
				}
			}
			
			
			function playClip(s_f,e_f)
		  	 {
		  	 	var fps=25;
		  	 	var start_time=Math.floor(s_f/fps);
		  	 	var end_time=Math.floor(e_f/fps);
		  	 	var interval=(end_time-start_time+1)*1000;
		  	 	
				if(myVideo.paused)
				{
					stop();
					myVideo.currentTime+=start_time;
					myVideo.play();
					sysButton();
					setTimeout("myVideo.pause()",interval);
					
				}else
				{
					stop();
					myVideo.pause();
					myVideo.currentTime+=start_time;
					myVideo.play();
					sysButton();
					setTimeout("myVideo.pause()",interval);
					
				}
		  	 }
			function stop()
			{
				myVideo.currentTime = 0;
				myVideo.pause();
				mySpan.className="glyphicon glyphicon-play";
			}
			
			function sysButton()
			{
				if(myVideo.paused)
				{
					mySpan.className="glyphicon glyphicon-pause";
				}
				else
				{
					mySpan.className="glyphicon glyphicon-play";				
				}
		}
		</script>
		<script type="text/javascript" src="appearanceDuration.php"></script> 
		
	</body>
	
</html>